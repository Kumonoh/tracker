<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Progress Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        .header {
            background: #4a90e2;
            color: white;
            padding: 20px 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 24px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .card h2 {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .student-card {
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .student-card:hover {
            border-color: #4a90e2;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.15);
            transform: translateY(-2px);
        }
        
        .student-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .student-progress {
            font-size: 14px;
            color: #5f6368;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e8eaed;
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #1a73e8;
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        .btn-primary {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover {
            background: #357abd;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: #4a90e2;
            border: 2px solid #4a90e2;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-secondary:hover {
            background: #f0f7ff;
            transform: translateY(-1px);
        }
        
        .skill-category {
            margin-bottom: 24px;
        }
        
        .category-title {
            font-size: 26px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid #4a90e2;
        }
        
        /* Assessment sections styling */
        .assessment-section .category-title {
            color: #5f6368;
            border-bottom: 3px solid #7fb3d5;
            font-style: italic;
        }
        
        .assessment-section .skill-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .assessment-section .skill-item {
            background: #f0f7ff;
            border-left: 4px solid #4a90e2;
            border-radius: 8px;
        }
            border-left: 4px solid #8ab4f8;
            padding-left: 16px;
            width: 100%;
        }
        
        .assessment-section .skill-item:hover {
            background: #d2e3fc;
        }
        
        .assessment-section .skill-label {
            font-size: 20px;
            line-height: 1.4;
            color: #3c4043;
        }
        
        .skill-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 12px;
        }
        
        .vowel-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border: 3px solid #4a90e2;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .vowel-table th {
            background: #e3f2fd;
            padding: 18px;
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            color: #2c3e50;
            border: 2px solid #bbdefb;
        }
        
        .vowel-table td {
            padding: 12px;
            text-align: center;
            border: 2px solid #e1e8ed;
            background: white;
        }
        
        .vowel-table .skill-item {
            margin: 0;
            justify-content: center;
            padding: 12px;
            background: transparent;
        }
        
        .vowel-table .skill-label {
            font-size: 28px;
        }
        
        .vowel-table .range-label {
            font-size: 22px;
            font-weight: 600;
            color: #5f6368;
            padding: 12px;
            text-align: center;
            background: #f8f9fa;
        }
        
        .skill-item {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            margin-bottom: 8px;
        }
        
        .skill-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }
            margin-bottom: 12px;
        }
        
        .skill-item:hover {
            background: #e8f0fe;
        }
        
        .skill-item.checked {
            background: #e8f5e9;
        }
        
        .checkbox {
            width: 32px;
            height: 32px;
            border: 3px solid #bdc3c7;
            border-radius: 6px;
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }
        
        .skill-item.checked .checkbox {
            background: #5cb85c;
            border-color: #5cb85c;
        }
        
        .skill-item.checked .checkbox::after {
            content: '‚úì';
            color: white;
            font-size: 22px;
            font-weight: bold;
        }
        
        .skill-label {
            font-size: 24px;
            font-weight: 500;
            color: #202124;
        }
        
        .notes-section {
            margin-top: 24px;
        }
        
        .notes-label {
            font-size: 14px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 8px;
            display: block;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #1a73e8;
        }
        
        .action-bar {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e8eaed;
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #1a73e8;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #202124;
        }
        
        .stat-label {
            font-size: 13px;
            color: #5f6368;
            margin-top: 4px;
        }
        
        .hidden {
            display: none;
        }
        
        .breadcrumb {
            color: #5f6368;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .breadcrumb a {
            color: #1a73e8;
            text-decoration: none;
            cursor: pointer;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .level-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .level-btn {
            background: white;
            border: 2px solid #e1e8ed;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .level-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Pastel colors for each level */
        .level-btn:nth-child(1) { background: #ffe4e1; border-color: #ffb3ba; } /* Soft pink */
        .level-btn:nth-child(2) { background: #e1f5ff; border-color: #b3daff; } /* Soft blue */
        .level-btn:nth-child(3) { background: #fff9e1; border-color: #ffe9a3; } /* Soft yellow */
        .level-btn:nth-child(4) { background: #e1ffe1; border-color: #b3ffb3; } /* Soft green */
        .level-btn:nth-child(5) { background: #f5e1ff; border-color: #dab3ff; } /* Soft purple */
        .level-btn:nth-child(6) { background: #ffe1f5; border-color: #ffb3e6; } /* Soft magenta */
        .level-btn:nth-child(7) { background: #e1fff5; border-color: #b3ffe6; } /* Soft mint */
        .level-btn:nth-child(8) { background: #fff0e1; border-color: #ffd9b3; } /* Soft peach */
        .level-btn:nth-child(9) { background: #ffe8f0; border-color: #ffcce0; } /* Soft rose */
        
        .level-btn-title {
            font-size: 17px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 6px;
        }
        
        .level-btn-desc {
            font-size: 14px;
            color: #5f6368;
            font-weight: 500;
        }
        
        /* Resources page styles */
        .resources-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .resource-section {
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            overflow: hidden;
            background: white;
        }
        
        .resource-section-header {
            display: flex;
            flex-direction: column;
            padding: 20px 24px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .resource-section-header:hover {
            background: #e9ecef;
        }
        
        .resource-section-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .resource-section-title {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .resource-section-toggle {
            font-size: 24px;
            color: #5f6368;
            transition: transform 0.2s ease;
        }
        
        .resource-section.expanded .resource-section-toggle {
            transform: rotate(180deg);
        }
        
        .assessment-checkboxes {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        
        .assessment-checkboxes::before {
            content: "Assessment (select one):";
            width: 100%;
            font-size: 12px;
            color: #5f6368;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .assessment-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .assessment-checkbox:hover {
            border-color: #4a90e2;
            transform: translateY(-1px);
        }
        
        .assessment-checkbox.needs-improvement {
            border-color: #f44336;
            background: #ffebee;
            font-weight: 700;
        }
        
        .assessment-checkbox.improving {
            border-color: #ff9800;
            background: #fff3e0;
            font-weight: 700;
        }
        
        .assessment-checkbox.mastered {
            border-color: #5cb85c;
            background: #d4edda;
            font-weight: 700;
        }
        
        .assessment-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            pointer-events: none; /* Prevent direct clicks on checkbox */
        }
        
        .assessment-checkbox label {
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .resource-section-content {
            display: none;
            padding: 16px;
            background: white;
        }
        
        .resource-section.expanded .resource-section-content {
            display: block;
        }
        
        .resource-item {
            display: flex;
            flex-direction: column;
            padding: 16px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }
        
        .resource-item:hover {
            border-color: #4a90e2;
            background: #f0f7ff;
        }
        
        .resource-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .resource-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-decoration: none;
            flex: 1;
        }
        
        .resource-link:hover {
            text-decoration: none;
        }
        
        .resource-title {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .resource-desc {
            font-size: 14px;
            color: #4a90e2;
            font-weight: 600;
        }
        
        .forward-to-parent {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f0f7ff;
            border-radius: 6px;
            border: 2px solid #e1e8ed;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .forward-to-parent:hover {
            border-color: #4a90e2;
            background: #e3f2fd;
        }
        
        .forward-to-parent input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .forward-to-parent label {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
        }
        
        .forward-to-parent.checked {
            background: #d4edda;
            border-color: #5cb85c;
        }
        
        .resource-count {
            font-size: 14px;
            color: #5f6368;
            font-weight: 500;
        }
        
        /* Comment checkbox styling */
        .comment-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: #f8f9fa;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }
        
        .comment-checkbox:hover {
            background: #e9ecef;
            border-color: #4a90e2;
        }
        
        .comment-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .comment-checkbox span {
            flex: 1;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .success-message {
            background: #e8f5e9;
            color: #137333;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
            border-left: 4px solid #34a853;
        }
        
        .session-info {
            background: #e8f0fe;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #174ea6;
        }
        
        .add-student-btn {
            background: #34a853;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 16px;
        }
        
        .add-student-btn:hover {
            background: #2d8e47;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìö Student Progress Tracker</h1>
    </div>
    
    <div class="container">
        <!-- Page 1: Student Selection -->
        <div id="studentSelectionPage">
            <div class="card">
                <h2>üëã Welcome, Teacher!</h2>
                
                <!-- Staff Name Dropdown -->
                <div style="margin-bottom: 32px;">
                    <label for="staffNameSelect" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                        Staff Name:
                    </label>
                    <div style="display: flex; gap: 12px; max-width: 500px;">
                        <select id="staffNameSelect" 
                                style="flex: 1; padding: 12px; font-size: 16px; border: 2px solid #e1e8ed; border-radius: 8px;"
                                onchange="selectStaffName()">
                            <option value="">-- Select your name --</option>
                            <!-- Staff names will be populated here -->
                        </select>
                        <button class="btn-secondary" onclick="refreshMasterData()" style="white-space: nowrap;" title="Refresh staff and student lists from Google Sheets">
                            üîÑ Refresh
                        </button>
                    </div>
                    <p style="font-size: 13px; color: #5f6368; margin-top: 8px;">
                        üí° Manage staff and students in the "Staff & Students" sheet
                    </p>
                </div>
                
                <!-- EL (Early Learners) Section -->
                <h2 style="color: #2c3e50; margin-top: 40px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 3px solid #4a90e2;">
                    üé® Early Learners (EL)
                </h2>
                <div style="max-width: 500px;">
                    <label for="elStudentSelect" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                        Select Student:
                    </label>
                    <select id="elStudentSelect" 
                            style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #e1e8ed; border-radius: 8px; margin-bottom: 16px;">
                        <option value="">-- Choose a student --</option>
                    </select>
                    <button class="btn-primary" onclick="selectELStudent()" style="width: 100%;">
                        üìö Start Session with Selected Student
                    </button>
                </div>
                
                <!-- Main Classroom Section -->
                <h2 style="color: #2c3e50; margin-top: 48px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 3px solid #5cb85c;">
                    üìö Main Classroom
                </h2>
                <div style="max-width: 500px;">
                    <label for="mainClassroomStudent" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                        Select Student:
                    </label>
                    <select id="mainClassroomStudent" 
                            style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #e1e8ed; border-radius: 8px; margin-bottom: 16px;">
                        <option value="">-- Choose a student --</option>
                    </select>
                    <button class="btn-primary" onclick="selectMainClassroomStudent()" style="width: 100%;">
                        üìù Add Comments for Selected Student
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Page 2A: Main Classroom Comments -->
        <div id="mainClassroomCommentsPage" class="hidden">
            <div class="breadcrumb">
                <a onclick="backToStudents()">‚Üê Back to Students</a>
            </div>
            
            <div class="card">
                <h2>üìù Comments for <span id="mainClassroomStudentName"></span></h2>
                <p style="color: #5f6368; margin-bottom: 24px;">Select applicable comments and add notes</p>
                
                <div id="successMessage" class="success-message hidden"></div>
                
                <!-- Comment Checkboxes -->
                <div style="margin-bottom: 32px;">
                    <h3 style="color: #2c3e50; margin-bottom: 16px;">Select Issues/Observations:</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label class="comment-checkbox">
                            <input type="checkbox" value="Skipping Pages/Corrections">
                            <span>‚ö†Ô∏è Skipping Pages/Corrections</span>
                        </label>
                        <label class="comment-checkbox">
                            <input type="checkbox" value="Skipping Homework/Missing Assignments">
                            <span>üìã Skipping Homework/Missing Assignments</span>
                        </label>
                        <label class="comment-checkbox">
                            <input type="checkbox" value="Skipping Steps but 100%">
                            <span>‚úÖ Skipping Steps but 100%</span>
                        </label>
                        <label class="comment-checkbox">
                            <input type="checkbox" value="Skipping Steps (Wrong Answers)">
                            <span>‚ùå Skipping Steps (Wrong Answers)</span>
                        </label>
                        <label class="comment-checkbox">
                            <input type="checkbox" value="Many Pauses">
                            <span>‚è∏Ô∏è Many Pauses</span>
                        </label>
                        <label class="comment-checkbox">
                            <input type="checkbox" value="Wrote Positive or Negative Notes">
                            <span>üìù Wrote Positive or Negative Notes</span>
                        </label>
                        <label class="comment-checkbox">
                            <input type="checkbox" value="Needs Assistance With Concept">
                            <span>ü§î Needs Assistance With Concept</span>
                        </label>
                        <label class="comment-checkbox">
                            <input type="checkbox" value="Needs Lesson Planning">
                            <span>üìö Needs Lesson Planning</span>
                        </label>
                        <label class="comment-checkbox">
                            <input type="checkbox" value="Other" id="otherCheckbox" onchange="toggleOtherField()">
                            <span>‚úèÔ∏è Other:</span>
                        </label>
                        <input type="text" id="otherCommentField" placeholder="Specify other issue..." 
                               style="margin-left: 32px; padding: 8px; border: 2px solid #e1e8ed; border-radius: 6px; display: none;">
                    </div>
                </div>
                
                <!-- Additional Notes -->
                <div style="margin-bottom: 24px;">
                    <h3 style="color: #2c3e50; margin-bottom: 12px;">Additional Notes/Paragraph:</h3>
                    <textarea id="mainClassroomNotes" rows="6" 
                              style="width: 100%; padding: 12px; font-size: 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-family: inherit;"
                              placeholder="Write additional observations, progress notes, or detailed comments here..."></textarea>
                </div>
                
                <!-- Immediate Attention Checkbox -->
                <div style="margin-bottom: 24px; padding: 16px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; font-size: 16px; font-weight: 600;">
                        <input type="checkbox" id="mainAttentionNeeded" style="width: 24px; height: 24px; cursor: pointer;">
                        <span>üö® Immediate Attention Needed (Alert)</span>
                    </label>
                    <p style="font-size: 13px; color: #856404; margin-top: 8px; margin-left: 36px;">
                        Check this box if this student requires urgent follow-up or intervention
                    </p>
                </div>
                
                <!-- Save Button -->
                <button class="btn-primary" onclick="saveMainClassroomComments()" style="width: 100%; font-size: 18px; padding: 16px;">
                    üíæ Save Comments
                </button>
                
                <!-- Comments History -->
                <div style="margin-top: 40px;">
                    <h3 style="color: #2c3e50; margin-bottom: 16px;">Previous Comments</h3>
                    <div id="mainClassroomHistory"></div>
                </div>
            </div>
        </div>
        
        <!-- Page 2: Level Selection -->
        <div id="levelSelectionPage" class="hidden">
            <div class="breadcrumb">
                <a onclick="backToStudents()">‚Üê Back to Students</a>
            </div>
            
            <div class="card">
                <h2>Choose Level for <span id="currentStudentName"></span></h2>
                <div class="level-selector">
                    <div class="level-btn" onclick="selectLevel('Reading 5A')">
                        <div class="level-btn-title">Reading 5A</div>
                        <div class="level-btn-desc">Letter sounds & words</div>
                    </div>
                    <div class="level-btn" onclick="selectLevel('Reading 4A')">
                        <div class="level-btn-title">Reading 4A</div>
                        <div class="level-btn-desc">Blends & memory</div>
                    </div>
                    <div class="level-btn" onclick="selectLevel('Reading 3A')">
                        <div class="level-btn-title">Reading 3A</div>
                        <div class="level-btn-desc">Challenging sounds</div>
                    </div>
                    <div class="level-btn" onclick="selectLevel('Sight Words')">
                        <div class="level-btn-title">üìö Sight Words</div>
                        <div class="level-btn-desc">100 important words</div>
                    </div>
                    <div class="level-btn" onclick="selectLevel('Math 6A')">
                        <div class="level-btn-title">Math 6A</div>
                        <div class="level-btn-desc">Numbers 1-10</div>
                    </div>
                    <div class="level-btn" onclick="selectLevel('Math 5A')">
                        <div class="level-btn-title">Math 5A</div>
                        <div class="level-btn-desc">Numbers to 50</div>
                    </div>
                    <div class="level-btn" onclick="selectLevel('Math 4A')">
                        <div class="level-btn-title">Math 4A</div>
                        <div class="level-btn-desc">Numbers to 100</div>
                    </div>
                    <div class="level-btn" onclick="selectLevel('Math 3A')">
                        <div class="level-btn-title">Math 3A</div>
                        <div class="level-btn-desc">Addition basics</div>
                    </div>
                    <div class="level-btn" onclick="showResources()">
                        <div class="level-btn-title">üìÇ Resources</div>
                        <div class="level-btn-desc">PDFs & materials</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resources Page -->
        <div id="resourcesPage" class="hidden">
            <div class="breadcrumb">
                <a onclick="backToLevels()">‚Üê Back to Levels</a> / <a onclick="backToStudents()">Students</a>
            </div>
            
            <div class="card">
                <h2>üìÇ Resources for <span id="resourcesStudentName"></span></h2>
                <p style="color: #5f6368; margin-bottom: 16px;">Select resources to forward to parent ‚Ä¢ Assess progress (one per level) ‚Ä¢ Click headers to expand/collapse</p>
                
                <button class="btn-primary" onclick="viewSelectedResources()" style="margin-bottom: 20px;">
                    üìã View Selected Resources (<span id="selectedResourceCount">0</span>)
                </button>
                
                <!-- Reading Section -->
                <h2 style="color: #2c3e50; margin-top: 32px; margin-bottom: 16px; font-size: 24px; border-bottom: 3px solid #4a90e2; padding-bottom: 8px;">üìö Reading Levels</h2>
                <div id="readingResourcesSections"></div>
                
                <!-- Math Section -->
                <h2 style="color: #2c3e50; margin-top: 48px; margin-bottom: 16px; font-size: 24px; border-bottom: 3px solid #5cb85c; padding-bottom: 8px;">üî¢ Math Levels</h2>
                <div id="mathResourcesSections"></div>
            </div>
        </div>
        
        <!-- Page 3: Skill Tracking -->
        <div id="skillTrackingPage" class="hidden">
            <div class="breadcrumb">
                <a onclick="backToLevels()">‚Üê Back to Levels</a> / <a onclick="backToStudents()">Students</a>
            </div>
            
            <div id="successMessage" class="success-message hidden"></div>
            
            <!-- DIAGNOSTIC MESSAGE -->
            <div id="diagnosticMessage" style="padding: 12px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; margin-bottom: 16px; display: none;">
                <strong>üîç Diagnostic Info:</strong>
                <div id="diagnosticDetails"></div>
            </div>
            
            <div class="card">
                <div class="session-info">
                    üìÖ Session: <span id="sessionDate"></span> | Student: <span id="trackingStudentName"></span> | Level: <span id="trackingLevel"></span>
                </div>
                
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value" id="completedCount">0</div>
                        <div class="stat-label">Skills Mastered</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="remainingCount">0</div>
                        <div class="stat-label">Skills to Work On</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="progressPercent">0%</div>
                        <div class="stat-label">Progress</div>
                    </div>
                </div>
                
                <div id="skillsContainer"></div>
                
                <div class="notes-section">
                    <label class="notes-label">üìù Session Notes & Comments</label>
                    <textarea id="sessionNotes" placeholder="Add notes about today's session... What went well? What needs more practice?"></textarea>
                </div>
                
                <!-- Immediate Attention Checkbox for EL -->
                <div style="margin: 16px 0; padding: 16px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; font-size: 16px; font-weight: 600;">
                        <input type="checkbox" id="elAttentionNeeded" style="width: 24px; height: 24px; cursor: pointer;">
                        <span>üö® Immediate Attention Needed (Alert)</span>
                    </label>
                    <p style="font-size: 13px; color: #856404; margin-top: 8px; margin-left: 36px;">
                        Check this box if this student requires urgent follow-up or intervention
                    </p>
                </div>
                
                <div class="notes-section" id="notesHistorySection">
                    <label class="notes-label">üìã Previous Session Notes</label>
                    <div id="notesHistory" style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 16px; border-radius: 4px; font-size: 14px;">
                        <!-- Notes history will appear here -->
                    </div>
                </div>
                
                <div class="action-bar">
                    <button class="btn-primary" onclick="saveSession()">üíæ Save Session</button>
                    <button class="btn-secondary" onclick="generatePrintReport()">üìÑ Generate 4x6 Report Card</button>
                    <button class="btn-secondary" onclick="backToLevels()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - UPDATED WITH YOUR LATEST SCRIPT URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyJPrcSSXJFxp7vCJZX9b9gk2wLOIntQ3g3QivoCn-V0crR1NvYr84xTiiAtJdImvHRVA/exec';
        
        // Student data
        // Staff and student data - loaded from Google Sheets
        let staffList = [];
        let elStudentsList = [];
        let mainStudentsList = [];
        let staffName = '';
        
        // Local student progress data (saved locally)
        let studentProgressData = {};
        
        let currentStudent = null;
        let currentStudentType = null; // 'el' or 'main'
        let currentLevel = null;
        
        // Skills data
        const skillsData = {
            'Reading 5A': {
                '5A (1-10)': ['b', 'k', 'p', 't'],
                '5A (11-20)': ['d', 'g', 'c', 'j'],
                '5A (21-30)': ['m', 's', 'n', 'l'],
                '5A (31-40)': ['f', 'r', 'h', 'w'],
                '5A (41-50)': ['n', 'j', 'b', 'h'],
                '5A (51-60)': ['r', 's', 'd', 'w'],
                '5A (61-70)': ['c', 't', 'g', 'm'],
                '5A (71-80)': ['p', 'k', 'f', 'l'],
                '5A (81-90)': ['b', 's', 'x', 'z'],
                '5A (91-100)': ['q', 'v', 'y', 'a'],
                '5A (101-110)': ['e', 'i', 'o', 'u'],
                '5A 3-Letter Words': {
                    headers: ['a', 'e', 'i', 'o', 'u'],
                    rows: [
                        ['bat', 'red', 'hip', 'dog', 'bug'],
                        ['cap', 'ten', 'sit', 'box', 'mud'],
                        ['sad', 'bed', 'win', 'pot', 'cup'],
                        ['fan', 'leg', 'pig', 'log', 'tub'],
                        ['mad', 'hen', 'kid', 'fox', 'gum']
                    ]
                },
                '5A Skills Assessment': [
                    'Can say individual letter sounds and sound out three-letter words',
                    'Uses pictures as support when reading words and sentences',
                    'Reads sentences on review pages with growing confidence',
                    'Shows a healthy level of enjoyment during reading work',
                    'Demonstrates increasing independence, concentration, and organization',
                    'Follows directions with less prompting',
                    'Understands and follows the routine more independently',
                    'Can concentrate and maintain a good working rhythm',
                    'Motor skills, stroke order, and neatness continue to improve',
                    'Shows interest in and enjoyment of specific books or stories'
                ]
            },
            'Sight Words': {
                'Side A (Words 1-50)': ['the', 'is', 'a', 'on', 'I', 'to', 'it', 'says', 'for', 'and', 'have', 'in', 'am', 'like', 'so', 'does', 'we', 'with', 'his', 'time', 'where', 'who', 'off', 'he', 'up', 'my', 'please', 'friend', 'has', 'see', 'her', 'do', 'not', 'at', 'an', 'put', 'by', 'can', 'you', 'get', 'want', 'one', 'of', 'will', 'she', 'pretty', 'are', 'him', 'live', 'me'],
                'Side B (Words 51-100)': ['from', 'what', 'your', "can't", 'but', 'push', 'help', 'when', 'three', 'its', 'went', 'that', 'they', 'away', 'must', 'jump', 'these', 'this', 'our', 'old', 'saw', 'eat', 'too', 'those', "it's", 'if', 'here', 'then', "don't", 'or', 'out', 'was', 'go', 'two', 'now', 'there', 'be', 'more', 'each', 'own', 'were', 'very', 'ready', 'some', 'than', 'use', 'wear', 'house', 'after', 'ate']
            },
            'Reading 4A': {
                '4A Consonant Combinations (Pages 1-28)': {
                    headers: ['bl_', 'cl_', 'fl_', 'gl_', 'br_', 'dr_'],
                    rows: [
                        ['blast', 'clap', 'flag', 'glad', 'brush', 'drum'],
                        ['black', 'class', 'flat', 'glass', 'brick', 'dress'],
                        ['block', 'clock', 'fly', 'glob', 'bring', 'drop']
                    ]
                },
                '4A Consonant Combinations Continued': {
                    headers: ['fr_', 'gr_', 'sm_', 'sp_', 'sk_', 'sn_'],
                    rows: [
                        ['frog', 'grab', 'smash', 'spin', 'skin', 'snug'],
                        ['fry', 'grass', 'smell', 'spell', 'skip', 'snack'],
                        ['fruit', 'green', 'small', 'spill', 'skate', 'snap']
                    ]
                },
                '4A Consonant Combinations (Pages 31-68)': {
                    headers: ['sl_', 'pl_', 'sc_', 'cr_', 'tw_', 'sw_'],
                    rows: [
                        ['slip', 'plug', 'scarf', 'crib', 'twig', 'swim'],
                        ['slug', 'plum', 'scoop', 'crack', 'twin', 'swift'],
                        ['sled', 'plant', 'scale', 'cry', 'twist', 'sweep']
                    ]
                },
                '4A Consonant Combinations More': {
                    headers: ['pr_', 'st_', 'tr_', 'str_', '_st', '_mp'],
                    rows: [
                        ['prod', 'stop', 'trip', 'street', 'lost', 'lamp'],
                        ['print', 'step', 'trap', 'stripe', 'nest', 'jump'],
                        ['prize', 'stand', 'track', 'strike', 'fast', 'bump']
                    ]
                },
                '4A Consonant Combinations (Pages 71-118)': {
                    headers: ['_ck', '_nk', '_nt', '_nd', 'ch_', '_ch'],
                    rows: [
                        ['duck', 'pink', 'ant', 'hand', 'chin', 'lunch'],
                        ['back', 'skunk', 'sent', 'pond', 'chop', 'bench'],
                        ['block', 'stink', 'plant', 'send', 'chick', 'church']
                    ]
                },
                '4A Changing Letter Sounds': {
                    headers: ['sh_', '_sh', 'wh_', '_ng', 'th_', '_th'],
                    rows: [
                        ['shop', 'bush', 'white', 'bring', 'thin', 'bath'],
                        ['shell', 'fish', 'wheel', 'long', 'thick', 'moth'],
                        ['ship', 'push', 'which', 'king', 'thank', 'teeth']
                    ]
                },
                '4A Vowel Combinations (Pages 121-136)': {
                    headers: ['_ay', '_ew', '_ow', '_oy', '_all'],
                    rows: [
                        ['play', 'new', 'mow', 'toy', 'ball'],
                        ['gray', 'chew', 'grow', 'joy', 'hall'],
                        ['pay', 'stew', 'snow', 'boy', 'fall']
                    ]
                },
                '4A Vowel Combinations Continued': {
                    headers: ['_old', '_own', '_alk', '_ight', '_aw'],
                    rows: [
                        ['cold', 'down', 'walk', 'night', 'draw'],
                        ['told', 'clown', 'chalk', 'tight', 'claw'],
                        ['hold', 'brown', 'stalk', 'fight', 'lawn']
                    ]
                },
                '4A R-Controlled Vowels (Pages 138-149)': {
                    headers: ['ar', 'or', 'ir', 'ur', 'or', 'er'],
                    rows: [
                        ['car', 'fort', 'girl', 'fur', 'worm', 'fern'],
                        ['star', 'storm', 'bird', 'hurt', 'work', 'herd'],
                        ['far', 'stork', 'first', 'turn', 'word', 'nerd']
                    ]
                },
                '4A (1-10)': ['bl', 'cl', 'fl', 'gl'],
                '4A (11-20)': ['br', 'dr', 'fr', 'gr'],
                '4A (21-30)': ['sm', 'sp', 'sk', 'sn'],
                '4A (31-40)': ['sl', 'pl', 'sc', 'cr'],
                '4A (51-60)': ['tw', 'sw', 'pr', 'st'],
                '4A (61-70)': ['tr', 'str', 'mp', 'st'],
                '4A (71-80)': ['ck', 'nk', 'nt', 'nd'],
                '4A (101-110)': ['ch', 'sh'],
                '4A (111-120)': ['wh', 'ng', 'th'],
                '4A (121-130)': ['ay', 'ew', 'ow', 'oy'],
                '4A (131-140)': ['old', 'own', 'alk', 'ight'],
                '4A (141-150)': ['ir', 'or', 'ur', 'er'],
                '4A (151-160)': ['a_e', 'i_e', 'o_e', 'u_e'],
                '4A Silent E Rule': {
                    headers: ['a_e', 'i_e', 'o_e', 'u_e'],
                    rows: [
                        ['cage', 'bike', 'nose', 'tube'],
                        ['grape', 'kite', 'bone', 'mule'],
                        ['make', 'ride', 'home', 'cute']
                    ]
                },
                '4A Skills Development': [
                    'Demonstrates growing ability to sound out and remember blends, words, and simple sentences',
                    'Is beginning to carry learning from the A-side to the B-side',
                    'Shows increasing recall during review sets and story sets',
                    'Attempts work independently, with appropriate support when needed',
                    'Shows a positive level of enjoyment and engagement',
                    'Is developing independence, work skills, and organization',
                    'Follows directions with growing consistency',
                    'Is becoming familiar with the daily routine',
                    'Can concentrate and work with a steady rhythm for an increasing amount of time',
                    'Motor skills, stroke order, and neatness are developing appropriately'
                ]
            },
            'Reading 3A': {
                '3A Challenging Sounds II': {
                    headers: ['wr_', 'ph_/_ph', 'sch_', 'scr_', 'thr_'],
                    rows: [
                        ['wrist', 'phone', 'school', 'scrape', 'three'],
                        ['wrap', 'graph', 'scholar', 'scrap', 'thrill'],
                        ['wreck', 'orphan', 'scheme', 'scrub', 'throat']
                    ]
                },
                '3A Challenging Sounds II - Endings': {
                    headers: ['_mb', '_ow', '_ue', 'ou'],
                    rows: [
                        ['numb', 'how', 'glue', 'out'],
                        ['thumb', 'cow', 'blue', 'south'],
                        ['lamb', 'brow', 'clue', 'pout']
                    ]
                },
                '3A Compound Words': ['snowman', 'uphill', 'birdcage', 'downstairs', 'haircut', 'handstand', 'blueberry', 'doorbell', 'sandbox', 'toothbrush', 'firewood', 'blackbird', 'rainbow', 'overcoat', 'football'],
                '3A Vowel Combinations': {
                    headers: ['ee', 'oo', 'ai', 'ea', 'oa', 'oo'],
                    rows: [
                        ['see', 'room', 'aim', 'eat', 'oak', 'hook'],
                        ['cheek', 'cool', 'pail', 'leaf', 'coach', 'good'],
                        ['seed', 'noon', 'braid', 'teach', 'boat', 'book']
                    ]
                },
                '3A Vowel Combinations Continued': {
                    headers: ['ou', 'oi', 'ea', 'ui', 'air'],
                    rows: [
                        ['ouch', 'oil', 'bread', 'fruit', 'air'],
                        ['mouth', 'coin', 'sweat', 'suit', 'pair'],
                        ['couch', 'point', 'breath', '', '']
                    ]
                },
                '3A Double Consonants': {
                    headers: ['nn', 'tt', 'll', 'bb', 'mm', 'cc'],
                    rows: [
                        ['bunny', 'butter', 'jelly', 'rabbit', 'mommy', 'soccer'],
                        ['funny', 'letter', 'silly', 'ribbon', 'tummy', 'raccoon'],
                        ['penny', 'bottle', 'dollar', 'bubble', 'hammer', 'broccoli']
                    ]
                },
                '3A Double Consonants Continued': {
                    headers: ['ss', 'dd', 'pp', 'gg', 'rr', 'ff'],
                    rows: [
                        ['messy', 'muddy', 'happy', 'juggle', 'cherry', 'muffin'],
                        ['glasses', 'ladder', 'puppet', 'wiggle', 'furry', 'fluffy'],
                        ['lesson', 'saddle', 'zipper', 'foggy', 'berry', 'traffic']
                    ]
                },
                '3A Challenging Sounds I': {
                    headers: ['_y (e)', '_ly', '_y (i)', '_er', '_le', '_ey'],
                    rows: [
                        ['baby', 'daily', 'fly', 'cooler', 'bottle', 'key'],
                        ['silly', 'madly', 'sky', 'batter', 'handle', 'monkey'],
                        ['jelly', 'partly', 'my', 'summer', 'bubble', 'turkey']
                    ]
                },
                '3A Challenging Sounds I - Endings': {
                    headers: ['_ing', '_tch', '_ge', '_ce', 'ci_'],
                    rows: [
                        ['ring', 'match', 'cage', 'race', 'city'],
                        ['thing', 'witch', 'rage', 'face', 'civil'],
                        ['sing', 'catch', 'stage', 'slice', 'civic']
                    ]
                },
                '3A Reading Assessment': [
                    'Is developing the ability to decode words and sentences',
                    'Is increasingly willing to try independently before seeking help',
                    'Shows a positive or improving level of enjoyment',
                    'Demonstrates growing independence, work skills, and organization'
                ]
            },
            'Math 6A': {
                'Number Recognition': ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
                'Counting': ['counts objects', 'counts dots', 'reads numbers']
            },
            'Math 5A': {
                'Numbers to 50': ['reads 1-50', 'recites 1-50', 'recognizes patterns']
            },
            'Math 4A': {
                'Numbers to 100': ['reads to 100', 'recites to 100', 'writes to 50']
            },
            'Math 3A': {
                'Number Sequence': ['writes to 50', 'writes to 100', 'writes to 120'],
                'Addition': ['+1', '+2', '+3']
            }
        };
        
        // Load from localStorage
        function loadData() {
            const saved = localStorage.getItem('studentProgressData');
            if (saved) {
                const data = JSON.parse(saved);
                if (data.staffList) staffList = data.staffList;
                if (data.elStudentsList) elStudentsList = data.elStudentsList;
                if (data.mainStudentsList) mainStudentsList = data.mainStudentsList;
                if (data.staffName) staffName = data.staffName;
                if (data.studentProgressData) studentProgressData = data.studentProgressData;
                
                // Legacy migration - convert old format if exists
                if (data.elStudents || data.mainStudents) {
                    // Migrate old student data
                    if (data.elStudents) {
                        Object.values(data.elStudents).forEach(student => {
                            if (!elStudentsList.includes(student.name)) {
                                elStudentsList.push(student.name);
                            }
                            studentProgressData[student.name] = student;
                        });
                    }
                    if (data.mainStudents) {
                        Object.values(data.mainStudents).forEach(student => {
                            if (!mainStudentsList.includes(student.name)) {
                                mainStudentsList.push(student.name);
                            }
                            studentProgressData[student.name] = student;
                        });
                    }
                }
            }
            
            // Initialize with default data if empty
            if (staffList.length === 0) {
                staffList = ['Ms. Johnson', 'Mr. Smith', 'Mrs. Davis', 'Mr. Wilson'];
            }
            if (elStudentsList.length === 0) {
                elStudentsList = ['Johnny Smith', 'Sarah Jones', 'Michael Brown'];
            }
        }
        
        // Save to localStorage
        function saveData() {
            localStorage.setItem('studentProgressData', JSON.stringify({
                staffList: staffList,
                elStudentsList: elStudentsList,
                mainStudentsList: mainStudentsList,
                staffName: staffName,
                studentProgressData: studentProgressData
            }));
        }
        
        // Helper function to get current student object
        function getCurrentStudent() {
            if (!currentStudent) return null;
            
            // Initialize if doesn't exist
            if (!studentProgressData[currentStudent]) {
                studentProgressData[currentStudent] = {
                    name: currentStudent,
                    type: currentStudentType,
                    progress: {},
                    resourcesToForward: {},
                    sectionAssessments: {},
                    sessions: [],
                    comments: []
                };
            }
            
            return studentProgressData[currentStudent];
        }
        
        // Render student selection page
        function renderStudentGrid() {
            // Render staff dropdown
            renderStaffDropdown();
            
            // Render EL students dropdown
            const elDropdown = document.getElementById('elStudentSelect');
            if (elDropdown) {
                elDropdown.innerHTML = '<option value="">-- Choose a student --</option>';
                elStudentsList.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    elDropdown.appendChild(option);
                });
            }
            
            // Render Main Classroom students dropdown
            const mainDropdown = document.getElementById('mainClassroomStudent');
            if (mainDropdown) {
                mainDropdown.innerHTML = '<option value="">-- Choose a student --</option>';
                mainStudentsList.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    mainDropdown.appendChild(option);
                });
            }
        }
        
        function renderStaffDropdown() {
            const dropdown = document.getElementById('staffNameSelect');
            if (!dropdown) return;
            
            dropdown.innerHTML = '<option value="">-- Select your name --</option>';
            
            staffList.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                dropdown.appendChild(option);
            });
            
            // Set current staff name if exists
            if (staffName) {
                dropdown.value = staffName;
            }
        }
        
        function selectStaffName() {
            const dropdown = document.getElementById('staffNameSelect');
            staffName = dropdown.value;
            saveData();
        }
        
        function selectELStudent() {
            // Validate staff name is selected
            const staffDropdown = document.getElementById('staffNameSelect');
            if (!staffDropdown || !staffDropdown.value) {
                alert('Please select your staff name first!');
                return;
            }
            
            const dropdown = document.getElementById('elStudentSelect');
            const studentName = dropdown.value;
            
            if (!studentName) {
                alert('Please select a student first!');
                return;
            }
            
            staffName = staffDropdown.value;
            currentStudent = studentName;
            currentStudentType = 'el';
            
            saveData();
            
            document.getElementById('studentSelectionPage').classList.add('hidden');
            document.getElementById('levelSelectionPage').classList.remove('hidden');
            document.getElementById('currentStudentName').textContent = studentName;
        }
        
        async function refreshMasterData() {
            const button = event.target;
            button.disabled = true;
            button.textContent = '‚è≥ Loading...';
            
            try {
                // Fetch from Google Sheets "Staff & Students" sheet
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getMasterData', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                const data = await response.json();
                
                if (data.staff) staffList = data.staff;
                if (data.elStudents) elStudentsList = data.elStudents;
                if (data.mainStudents) mainStudentsList = data.mainStudents;
                
                saveData();
                renderStudentGrid();
                
                alert('‚úì Staff and student lists refreshed from Google Sheets!');
            } catch (error) {
                console.error('Error refreshing data:', error);
                alert('Could not refresh from Google Sheets. Using local data.');
            } finally {
                button.disabled = false;
                button.textContent = 'üîÑ Refresh';
            }
        }
        
        function getTotalSkillsForStudent(student) {
            let total = 0;
            Object.values(skillsData).forEach(level => {
                Object.values(level).forEach(categoryData => {
                    // Handle table structure (headers and rows)
                    if (categoryData.headers && categoryData.rows) {
                        categoryData.rows.forEach(row => {
                            row.forEach((item, index) => {
                                // Skip empty items, range labels (first column with pattern like "11-20"), and Review Set labels
                                if (item && !(index === 0 && (/^\d+-\d+$/.test(item) || item.includes('Review Set')))) {
                                    total++;
                                }
                            });
                        });
                    } else {
                        // Handle regular array structure
                        total += categoryData.length;
                    }
                });
            });
            return total;
        }
        
        function getCompletedSkillsForStudent(student) {
            let count = 0;
            if (student.progress) {
                Object.values(student.progress).forEach(level => {
                    Object.values(level).forEach(category => {
                        Object.values(category).forEach(skill => {
                            if (skill.mastered) count++;
                        });
                    });
                });
            }
            return count;
        }
        
        // Page navigation
        function selectMainClassroomStudent() {
            // Validate staff name is selected
            const staffDropdown = document.getElementById('staffNameSelect');
            if (!staffDropdown || !staffDropdown.value) {
                alert('Please select your staff name first!');
                return;
            }
            
            staffName = staffDropdown.value;
            
            const dropdown = document.getElementById('mainClassroomStudent');
            const studentName = dropdown.value;
            
            if (!studentName) {
                alert('Please select a student first!');
                return;
            }
            
            currentStudent = studentName;
            currentStudentType = 'main';
            
            saveData();
            
            document.getElementById('studentSelectionPage').classList.add('hidden');
            document.getElementById('mainClassroomCommentsPage').classList.remove('hidden');
            document.getElementById('mainClassroomStudentName').textContent = studentName;
            
            // Render history
            renderMainClassroomHistory();
        }
        
        function toggleOtherField() {
            const checkbox = document.getElementById('otherCheckbox');
            const field = document.getElementById('otherCommentField');
            field.style.display = checkbox.checked ? 'block' : 'none';
            if (!checkbox.checked) {
                field.value = '';
            }
        }
        
        function saveMainClassroomComments() {
            const student = getCurrentStudent();
            const checkboxes = document.querySelectorAll('.comment-checkbox input[type="checkbox"]:checked');
            const selectedComments = [];
            
            checkboxes.forEach(cb => {
                if (cb.value === 'Other') {
                    const otherText = document.getElementById('otherCommentField').value.trim();
                    if (otherText) {
                        selectedComments.push(`Other: ${otherText}`);
                    }
                } else {
                    selectedComments.push(cb.value);
                }
            });
            
            const notes = document.getElementById('mainClassroomNotes').value.trim();
            const attentionNeeded = document.getElementById('mainAttentionNeeded').checked;
            
            if (selectedComments.length === 0 && !notes) {
                alert('Please select at least one comment or write a note!');
                return;
            }
            
            // Save to student record
            if (!student.comments) student.comments = [];
            student.comments.push({
                date: new Date().toLocaleDateString(),
                timestamp: new Date().toISOString(),
                staffName: staffName,
                selectedComments: selectedComments,
                notes: notes,
                attentionNeeded: attentionNeeded
            });
            
            saveData();
            
            // Save to Google Sheets
            saveMainClassroomToSheets(student, selectedComments, notes, attentionNeeded);
            
            // Clear form
            document.querySelectorAll('.comment-checkbox input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('otherCommentField').style.display = 'none';
            document.getElementById('otherCommentField').value = '';
            document.getElementById('mainClassroomNotes').value = '';
            document.getElementById('mainAttentionNeeded').checked = false;
            
            showSuccess('‚úì Comments saved successfully!');
            renderMainClassroomHistory();
        }
        
        async function saveMainClassroomToSheets(student, comments, notes, attentionNeeded) {
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'saveMainClassroom',
                        sheetName: 'Main Classroom',
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleDateString(),
                        staffName: staffName,
                        studentName: student.name,
                        comments: comments.join('; '),
                        notes: notes,
                        attentionNeeded: attentionNeeded ? 'YES' : 'NO'
                    })
                });
            } catch (error) {
                console.log('Error saving to sheets:', error);
            }
        }
        
        function renderMainClassroomHistory() {
            const container = document.getElementById('mainClassroomHistory');
            const student = getCurrentStudent();
            
            if (!student.comments || student.comments.length === 0) {
                container.innerHTML = '<p style="color: #5f6368;">No previous comments</p>';
                return;
            }
            
            let html = '';
            student.comments.slice().reverse().forEach(comment => {
                html += `
                    <div style="padding: 16px; background: #f8f9fa; border-left: 4px solid #4a90e2; border-radius: 8px; margin-bottom: 12px;">
                        <div style="font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                            üìÖ ${comment.date} | Staff: ${comment.staffName || 'Unknown'}
                        </div>
                        ${comment.selectedComments && comment.selectedComments.length > 0 ? `
                            <div style="margin-bottom: 8px;">
                                <strong>Issues:</strong><br>
                                ${comment.selectedComments.map(c => `‚Ä¢ ${c}`).join('<br>')}
                            </div>
                        ` : ''}
                        ${comment.notes ? `
                            <div>
                                <strong>Notes:</strong><br>
                                ${comment.notes}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function selectLevel(level) {
            currentLevel = level;
            document.getElementById('levelSelectionPage').classList.add('hidden');
            document.getElementById('skillTrackingPage').classList.remove('hidden');
            
            document.getElementById('trackingStudentName').textContent = getCurrentStudent().name;
            document.getElementById('trackingLevel').textContent = level;
            document.getElementById('sessionDate').textContent = new Date().toLocaleDateString();
            
            renderSkills();
            updateStats();
            renderNotesHistory();
            
            // Scroll to top of page to show skills
            window.scrollTo(0, 0);
        }
        
        function backToStudents() {
            document.getElementById('levelSelectionPage').classList.add('hidden');
            document.getElementById('skillTrackingPage').classList.add('hidden');
            document.getElementById('resourcesPage').classList.add('hidden');
            document.getElementById('mainClassroomCommentsPage').classList.add('hidden');
            document.getElementById('studentSelectionPage').classList.remove('hidden');
            currentStudent = null;
            currentStudentType = null;
            currentLevel = null;
        }
        
        function backToLevels() {
            document.getElementById('skillTrackingPage').classList.add('hidden');
            document.getElementById('resourcesPage').classList.add('hidden');
            document.getElementById('levelSelectionPage').classList.remove('hidden');
            currentLevel = null;
        }
        
        function showResources() {
            document.getElementById('levelSelectionPage').classList.add('hidden');
            document.getElementById('resourcesPage').classList.remove('hidden');
            document.getElementById('resourcesStudentName').textContent = getCurrentStudent().name;
            renderResources();
        }
        
        // Resources data structure - separated by Reading and Math
        const readingResources = {
            'üìï 7A Reading': [
                { title: 'üî§ Alphabet Chart', url: 'https://drive.google.com/file/d/1PVsfxeMRG6yv_zoGmVg1OShUmK0_X20z/view?usp=drivesdk' },
                { title: 'üé• 7A Reading Instruction Video', url: 'https://drive.google.com/file/d/1xxn4MwTzS3d1_OzcQreIOmARMu5GqBIu/view?usp=drivesdk' }
            ],
            'üìó 6A Reading': [
                { title: 'üî§ Alphabet Chart', url: 'https://drive.google.com/file/d/1PVsfxeMRG6yv_zoGmVg1OShUmK0_X20z/view?usp=drivesdk' },
                { title: 'üé• 6A Reading Instruction Video', url: 'https://drive.google.com/file/d/1dLAfpBCRunXwI9p91_2D-n9wilH3IVx8/view?usp=drivesdk' }
            ],
            'üìò 5A Reading': [
                { title: 'üî§ Alphabet Chart', url: 'https://drive.google.com/file/d/1PVsfxeMRG6yv_zoGmVg1OShUmK0_X20z/view?usp=drivesdk' },
                { title: 'üìã 5A Alphabet Sounds', url: 'https://drive.google.com/file/d/1MkraKhQprx7oQT4XnVqNMI9lQCi0h7wQ/view?usp=drivesdk' },
                { title: 'üìö 100 Important Words to Know Chart', url: 'https://drive.google.com/file/d/1dclmWRNXqfjH7NXF70AEju0uDbdN21lr/view?usp=drivesdk' },
                { title: 'üé• 5A Reading Instruction Video', url: 'https://drive.google.com/file/d/1doIfRjmE_v0TZt7H4Fw0ly04cXjiM796/view?usp=drivesdk' }
            ],
            'üìô 4A Reading': [
                { title: 'üó£Ô∏è Vowel Sounds Chart', url: 'https://drive.google.com/file/d/1xeKu5qaiGCRGOovFOBfMgVz48W_C6drE/view?usp=drivesdk' },
                { title: 'üîó Consonant Combinations Chart', url: 'https://drive.google.com/file/d/1m8q96PDjdl14Q8jA_Nt8GUfwdavSE5bu/view?usp=drivesdk' },
                { title: 'üìã 4A Consonant Combinations', url: 'https://drive.google.com/file/d/1HZ3I0mTT6dAxg5KmJ7ATgEiVVVjZYxa_/view?usp=drivesdk' },
                { title: 'üìã 4A/3A Vowel Sounds', url: 'https://drive.google.com/file/d/1RolcXTxT0rfLmFfWy4Zo3ruN9oflMwK1/view?usp=drivesdk' },
                { title: 'üìö 4A/3A 100 Important Words to Know', url: 'https://drive.google.com/file/d/1caf1nmpgde3NGF-mztXCGkhbTVqSxM0K/view?usp=drivesdk' },
                { title: 'üìö 100 Important Words to Know Chart', url: 'https://drive.google.com/file/d/1dclmWRNXqfjH7NXF70AEju0uDbdN21lr/view?usp=drivesdk' },
                { title: 'üé• 4A Reading Instruction Video', url: 'https://drive.google.com/file/d/16X1hHlY4gbidLTJ2xSeULf4CaRjkgfBi/view?usp=drivesdk' }
            ],
            'üìì 3A Reading': [
                { title: '‚ö° Challenging Sounds Chart', url: 'https://drive.google.com/file/d/1g0_Rxg8-p06F-ICXDWFZn2JA_IvamHB6/view?usp=drivesdk' },
                { title: 'üîó Consonant Combinations Chart', url: 'https://drive.google.com/file/d/1m8q96PDjdl14Q8jA_Nt8GUfwdavSE5bu/view?usp=drivesdk' },
                { title: 'üìã 4A/3A Vowel Sounds', url: 'https://drive.google.com/file/d/1RolcXTxT0rfLmFfWy4Zo3ruN9oflMwK1/view?usp=drivesdk' },
                { title: 'üìö 4A/3A 100 Important Words to Know', url: 'https://drive.google.com/file/d/1caf1nmpgde3NGF-mztXCGkhbTVqSxM0K/view?usp=drivesdk' },
                { title: 'üìö 100 Important Words to Know Chart', url: 'https://drive.google.com/file/d/1dclmWRNXqfjH7NXF70AEju0uDbdN21lr/view?usp=drivesdk' },
                { title: 'üé• 3A Reading Instruction Video', url: 'https://drive.google.com/file/d/1p9ceK8yoB7YccKhELhDTJbCbo5SUDnrW/view?usp=drivesdk' }
            ]
        };
        
        const mathResources = {
            'üî¢ 6A Math': [
                { title: 'üé• 6A Math Instruction Video', url: 'https://drive.google.com/file/d/1gjHikSW-4QNQVtIvTy1CXfFCop6ecaTa/view?usp=drivesdk' }
            ],
            'üî¢ 5A Math': [
                { title: 'üé• 5A Math Instruction Video', url: 'https://drive.google.com/file/d/1p8AjxAP_SVLVFTtuKj1KUIOmp2_VTzAk/view?usp=drivesdk' }
            ],
            'üî¢ 4A Math': [
                { title: 'üé• 4A Math Instruction Video', url: 'https://drive.google.com/file/d/164H512YZ4RzCLybmjSyaU9nWDXIEmn2E/view?usp=drivesdk' }
            ]
        };
        
        function renderResources() {
            const student = getCurrentStudent();
            
            // Initialize if not exists
            if (!student.resourcesToForward) {
                student.resourcesToForward = {};
            }
            if (!student.sectionAssessments) {
                student.sectionAssessments = {};
            }
            
            // Render reading sections
            document.getElementById('readingResourcesSections').innerHTML = renderResourceSections(readingResources, student);
            
            // Render math sections
            document.getElementById('mathResourcesSections').innerHTML = renderResourceSections(mathResources, student);
            
            // Update selected count
            updateSelectedResourceCount();
        }
        
        function renderResourceSections(resourcesData, student) {
            let html = '';
            Object.keys(resourcesData).forEach(section => {
                const resources = resourcesData[section];
                const selectedCount = resources.filter(r => student.resourcesToForward[r.title]).length;
                const assessment = student.sectionAssessments[section] || null;
                
                html += `
                    <div class="resource-section" style="margin-bottom: 16px;">
                        <div class="resource-section-header" onclick="toggleResourceSection(event, this)">
                            <div class="resource-section-header-top">
                                <div class="resource-section-title">${section} <span class="resource-count">(${selectedCount}/${resources.length} selected)</span></div>
                                <div class="resource-section-toggle">‚ñº</div>
                            </div>
                            <div class="assessment-checkboxes" onclick="event.stopPropagation()">
                                <!-- Radio button behavior: Only ONE can be selected at a time -->
                                <!-- Click same one to deselect, click different one to switch -->
                                <div class="assessment-checkbox ${assessment === 'needs-improvement' ? 'needs-improvement' : ''}" onclick="setAssessment('${section}', 'needs-improvement', this)">
                                    <input type="checkbox" ${assessment === 'needs-improvement' ? 'checked' : ''} readonly>
                                    <label>üî¥ Needs Improvement</label>
                                </div>
                                <div class="assessment-checkbox ${assessment === 'improving' ? 'improving' : ''}" onclick="setAssessment('${section}', 'improving', this)">
                                    <input type="checkbox" ${assessment === 'improving' ? 'checked' : ''} readonly>
                                    <label>üü° Improving</label>
                                </div>
                                <div class="assessment-checkbox ${assessment === 'mastered' ? 'mastered' : ''}" onclick="setAssessment('${section}', 'mastered', this)">
                                    <input type="checkbox" ${assessment === 'mastered' ? 'checked' : ''} readonly>
                                    <label>üü¢ Mastered</label>
                                </div>
                            </div>
                        </div>
                        <div class="resource-section-content">
                `;
                
                resources.forEach(resource => {
                    const isChecked = student.resourcesToForward[resource.title] || false;
                    const resourceId = `${section}-${resource.title}`.replace(/[^a-zA-Z0-9]/g, '_');
                    
                    html += `
                        <div class="resource-item">
                            <div class="resource-item-header">
                                <a href="${resource.url}" target="_blank" class="resource-link">
                                    <div class="resource-title">${resource.title}</div>
                                    <div class="resource-desc">View ‚Üí</div>
                                </a>
                            </div>
                            <div class="forward-to-parent ${isChecked ? 'checked' : ''}" onclick="toggleForwardToParent('${resource.title}', this)">
                                <input type="checkbox" id="${resourceId}" ${isChecked ? 'checked' : ''} onclick="event.stopPropagation();">
                                <label for="${resourceId}">‚úâÔ∏è Forwarded to parent</label>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        function setAssessment(section, level, element) {
            const student = getCurrentStudent();
            if (!student.sectionAssessments) {
                student.sectionAssessments = {};
            }
            
            // If clicking the same one that's already checked, uncheck it (clear assessment)
            if (student.sectionAssessments[section] === level) {
                student.sectionAssessments[section] = null;
            } else {
                // Set this as the ONLY assessment for this section
                // This automatically unselects any previously selected assessment
                student.sectionAssessments[section] = level;
            }
            
            saveData();
            
            // Re-render to update all checkboxes (only one will be checked)
            renderResources();
        }
            
        function updateSelectedResourceCount() {
            const student = getCurrentStudent();
            if (!student.resourcesToForward) {
                student.resourcesToForward = {};
            }
            
            const count = Object.values(student.resourcesToForward).filter(v => v).length;
            const countEl = document.getElementById('selectedResourceCount');
            if (countEl) {
                countEl.textContent = count;
            }
        }
        
        function viewSelectedResources() {
            const student = getCurrentStudent();
            if (!student.resourcesToForward) {
                alert('No resources selected yet!');
                return;
            }
            
            const selected = [];
            const allResources = {...readingResources, ...mathResources};
            
            Object.keys(allResources).forEach(section => {
                allResources[section].forEach(resource => {
                    if (student.resourcesToForward[resource.title]) {
                        selected.push({
                            section: section,
                            title: resource.title,
                            url: resource.url
                        });
                    }
                });
            });
            
            if (selected.length === 0) {
                alert('No resources selected yet! Check the boxes next to resources you want to forward.');
                return;
            }
            
            // Create summary text
            let summary = `Resources to Forward to ${student.name}'s Parent:\n\n`;
            let currentSection = '';
            
            selected.forEach(item => {
                if (item.section !== currentSection) {
                    summary += `\n${item.section}\n`;
                    currentSection = item.section;
                }
                summary += `  ‚Ä¢ ${item.title}\n    ${item.url}\n`;
            });
            
            summary += `\n\nTotal: ${selected.length} resources selected`;
            
            // Show in alert and copy to clipboard
            if (navigator.clipboard) {
                navigator.clipboard.writeText(summary).then(() => {
                    alert(summary + '\n\n‚úÖ Copied to clipboard!');
                }).catch(() => {
                    alert(summary);
                });
            } else {
                alert(summary);
            }
        }
        
        function toggleResourceSection(event, header) {
            const section = header.parentElement;
            section.classList.toggle('expanded');
        }
        
        function toggleForwardToParent(resourceTitle, element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            
            const student = getCurrentStudent();
            if (!student.resourcesToForward) {
                student.resourcesToForward = {};
            }
            
            student.resourcesToForward[resourceTitle] = checkbox.checked;
            
            // Update visual state
            if (checkbox.checked) {
                element.classList.add('checked');
            } else {
                element.classList.remove('checked');
            }
            
            // Save and re-render to update counts
            saveData();
            renderResources();
        }
        
        // Render skills
        function renderSkills() {
            const container = document.getElementById('skillsContainer');
            const diagnostic = document.getElementById('diagnosticMessage');
            const diagnosticDetails = document.getElementById('diagnosticDetails');
            
            // Show diagnostic info
            if (diagnostic) diagnostic.style.display = 'block';
            
            if (!container) {
                if (diagnosticDetails) {
                    diagnosticDetails.innerHTML = '‚ùå ERROR: skillsContainer element not found in HTML!';
                }
                console.error('skillsContainer not found!');
                return;
            }
            
            container.innerHTML = '';
            
            const levelSkills = skillsData[currentLevel];
            if (!levelSkills) {
                if (diagnosticDetails) {
                    diagnosticDetails.innerHTML = `‚ùå ERROR: No skills data for level "${currentLevel}"<br>Available levels: ${Object.keys(skillsData).join(', ')}`;
                }
                console.error('No skills data found for level:', currentLevel);
                container.innerHTML = `
                    <div style="padding: 40px; background: #ffebee; border: 2px solid #f44336; border-radius: 8px; text-align: center;">
                        <h3 style="color: #d32f2f; margin-bottom: 12px;">‚ö†Ô∏è Skills Not Found</h3>
                        <p>No skills data found for level: <strong>${currentLevel}</strong></p>
                        <p style="font-size: 14px; color: #666;">Please refresh the page or contact support.</p>
                    </div>
                `;
                return;
            }
            
            const categoryCount = Object.keys(levelSkills).length;
            console.log('‚úÖ Rendering skills for:', currentLevel, 'Categories:', categoryCount);
            
            if (diagnosticDetails) {
                diagnosticDetails.innerHTML = `‚úÖ Loading ${categoryCount} skill categories for "${currentLevel}"...`;
            }
            
            let totalSkillsRendered = 0;
            
            Object.keys(levelSkills).forEach(category => {
                const section = document.createElement('div');
                // Check if this is an assessment section
                const isAssessment = category.includes('Assessment') || 
                                   category.includes('Development') || 
                                   category.includes('Overall Progress');
                section.className = isAssessment ? 'skill-category assessment-section' : 'skill-category';
                
                const categoryData = levelSkills[category];
                
                // Check if this is a table structure (has headers and rows)
                if (categoryData.headers && categoryData.rows) {
                    let html = `<div class="category-title">${category.replace(/\(.*?\)/, '').trim()}</div>`;
                    html += '<table class="vowel-table">';
                    
                    // Header row
                    html += '<tr>';
                    categoryData.headers.forEach(header => {
                        html += `<th>${header}</th>`;
                    });
                    html += '</tr>';
                    
                    // Data rows
                    categoryData.rows.forEach(row => {
                        html += '<tr>';
                        row.forEach((word, colIndex) => {
                            // Skip empty cells
                            if (!word) {
                                html += '<td></td>';
                                return;
                            }
                            
                            // First column: check if it's a range label (like "11-20") or review set
                            if (colIndex === 0 && (/^\d+-\d+$/.test(word) || word.includes('Review Set'))) {
                                html += `<td class="range-label">${word}</td>`;
                            } else {
                                // Regular skill with checkbox
                                totalSkillsRendered++;
                                const isChecked = isSkillMastered(currentLevel, category, word);
                                html += `
                                    <td>
                                        <div class="skill-item ${isChecked ? 'checked' : ''}" onclick="toggleSkill('${category}', '${word}')">
                                            <div class="checkbox"></div>
                                            <span class="skill-label">${word}</span>
                                        </div>
                                    </td>
                                `;
                            }
                        });
                        html += '</tr>';
                    });
                    
                    html += '</table>';
                    section.innerHTML = html;
                } else {
                    // Regular grid layout
                    let html = `<div class="category-title">${category.replace(/\(.*?\)/, '').trim()}</div>`;
                    html += '<div class="skill-grid">';
                    
                    categoryData.forEach(skill => {
                        totalSkillsRendered++;
                        const isChecked = isSkillMastered(currentLevel, category, skill);
                        html += `
                            <div class="skill-item ${isChecked ? 'checked' : ''}" onclick="toggleSkill('${category}', '${skill}')">
                                <div class="checkbox"></div>
                                <span class="skill-label">${skill}</span>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    section.innerHTML = html;
                }
                
                container.appendChild(section);
            });
            
            console.log('‚úÖ Successfully rendered', totalSkillsRendered, 'skills');
            
            // Update diagnostic with success message
            if (diagnosticDetails) {
                diagnosticDetails.innerHTML = `‚úÖ Successfully loaded ${categoryCount} categories with ${totalSkillsRendered} skills for "${currentLevel}"`;
                // Hide diagnostic after 3 seconds if successful
                setTimeout(() => {
                    if (diagnostic) diagnostic.style.display = 'none';
                }, 3000);
            }
        }
        
        function isSkillMastered(level, category, skill) {
            const student = getCurrentStudent();
            if (!student.progress) return false;
            if (!student.progress[level]) return false;
            if (!student.progress[level][category]) return false;
            if (!student.progress[level][category][skill]) return false;
            return student.progress[level][category][skill].mastered === true;
        }
        
        function toggleSkill(category, skill) {
            const student = getCurrentStudent();
            
            if (!student.progress) student.progress = {};
            if (!student.progress[currentLevel]) student.progress[currentLevel] = {};
            if (!student.progress[currentLevel][category]) student.progress[currentLevel][category] = {};
            if (!student.progress[currentLevel][category][skill]) {
                student.progress[currentLevel][category][skill] = { mastered: false };
            }
            
            student.progress[currentLevel][category][skill].mastered = 
                !student.progress[currentLevel][category][skill].mastered;
            
            saveData();
            renderSkills();
            updateStats();
        }
        
        function updateStats() {
            const levelSkills = skillsData[currentLevel];
            let total = 0;
            let completed = 0;
            
            Object.keys(levelSkills).forEach(category => {
                levelSkills[category].forEach(skill => {
                    total++;
                    if (isSkillMastered(currentLevel, category, skill)) {
                        completed++;
                    }
                });
            });
            
            const remaining = total - completed;
            const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('remainingCount').textContent = remaining;
            document.getElementById('progressPercent').textContent = percent + '%';
        }
        
        // Save session to Google Sheets AND locally
        async function saveSession() {
            const notes = document.getElementById('sessionNotes').value;
            const attentionNeeded = document.getElementById('elAttentionNeeded').checked;
            const student = getCurrentStudent();
            
            // Count skills for this level
            const levelSkills = skillsData[currentLevel];
            let completed = 0;
            let total = 0;
            
            Object.keys(levelSkills).forEach(category => {
                const categoryData = levelSkills[category];
                
                // Handle table structure (headers and rows)
                if (categoryData.headers && categoryData.rows) {
                    categoryData.rows.forEach(row => {
                        row.forEach((skill, index) => {
                            // Skip empty items, range labels (first column with pattern like "11-20"), and Review Set labels
                            if (skill && !(index === 0 && (/^\d+-\d+$/.test(skill) || skill.includes('Review Set')))) {
                                total++;
                                if (isSkillMastered(currentLevel, category, skill)) {
                                    completed++;
                                }
                            }
                        });
                    });
                } else {
                    // Handle regular array structure
                    categoryData.forEach(skill => {
                        total++;
                        if (isSkillMastered(currentLevel, category, skill)) {
                            completed++;
                        }
                    });
                }
            });
            
            // Save notes locally
            if (!student.sessions) student.sessions = [];
            student.sessions.push({
                date: new Date().toLocaleDateString(),
                timestamp: new Date().toISOString(),
                level: currentLevel,
                completed: completed,
                total: total,
                notes: notes,
                attentionNeeded: attentionNeeded
            });
            
            saveData();
            
            // Save to Google Sheets (EL Sessions sheet)
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'saveELSession',
                        sheetName: 'EL Sessions',
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleDateString(),
                        staffName: staffName,
                        studentName: student.name,
                        level: currentLevel,
                        completedSkills: completed,
                        totalSkills: total,
                        progress: Math.round((completed / total) * 100) + '%',
                        notes: notes,
                        attentionNeeded: attentionNeeded ? 'YES' : 'NO'
                    })
                });
                
                showSuccess('‚úì Session saved to Google Sheets & locally!');
            } catch (error) {
                showSuccess('‚úì Session saved locally!');
            }
            
            // Clear notes and checkbox
            document.getElementById('sessionNotes').value = '';
            document.getElementById('elAttentionNeeded').checked = false;
            
            // Update student grid
            renderStudentGrid();
            
            // Refresh notes history
            renderNotesHistory();
        }
        
        function showSuccess(message) {
            const msgDiv = document.getElementById('successMessage');
            msgDiv.textContent = message;
            msgDiv.classList.remove('hidden');
            
            setTimeout(() => {
                msgDiv.classList.add('hidden');
            }, 3000);
        }
        
        function renderNotesHistory() {
            const container = document.getElementById('notesHistory');
            const student = getCurrentStudent();
            
            if (!student.sessions || student.sessions.length === 0) {
                container.innerHTML = '<div style="color: #5f6368; font-style: italic;">No previous sessions recorded yet.</div>';
                return;
            }
            
            // Filter sessions for current level and sort by date (newest first)
            const levelSessions = student.sessions
                .filter(s => s.level === currentLevel)
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            if (levelSessions.length === 0) {
                container.innerHTML = '<div style="color: #5f6368; font-style: italic;">No previous sessions for this level yet.</div>';
                return;
            }
            
            let html = '';
            levelSessions.forEach(session => {
                html += `
                    <div style="background: white; padding: 12px; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #1a73e8;">
                        <div style="font-weight: 600; color: #202124; margin-bottom: 4px;">
                            üìÖ ${session.date} - ${session.completed} of ${session.total} skills (${Math.round((session.completed / session.total) * 100)}%)
                        </div>
                        <div style="color: #5f6368;">
                            ${session.notes || '<em>No notes added</em>'}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function addNewStudent(type) {
            const studentType = type === 'main' ? 'Main Classroom' : 'Early Learner (EL)';
            const name = prompt(`Enter ${studentType} student full name:`);
            if (!name) return;
            
            const id = name.toLowerCase().replace(/\s+/g, '_');
            const students = type === 'main' ? mainStudents : elStudents;
            
            if (students[id]) {
                alert('Student already exists!');
                return;
            }
            
            students[id] = {
                name: name,
                type: type,
                progress: {},
                resourcesToForward: {},
                sectionAssessments: {},
                comments: []
            };
            
            saveData();
            renderStudentGrid();
        }
        
        // Generate 4x6 Print Report Card
        function generatePrintReport() {
            const student = getCurrentStudent();
            const levelSkills = skillsData[currentLevel];
            
            // Categorize skills
            const mastered = [];
            const needsWork = [];
            
            Object.keys(levelSkills).forEach(category => {
                const categoryData = levelSkills[category];
                
                // Handle table structure (headers and rows)
                if (categoryData.headers && categoryData.rows) {
                    categoryData.rows.forEach(row => {
                        row.forEach((skill, index) => {
                            // Skip empty items, range labels (first column with pattern like "11-20"), and Review Set labels
                            if (skill && !(index === 0 && (/^\d+-\d+$/.test(skill) || skill.includes('Review Set')))) {
                                if (isSkillMastered(currentLevel, category, skill)) {
                                    mastered.push(skill);
                                } else {
                                    needsWork.push(skill);
                                }
                            }
                        });
                    });
                } else {
                    // Handle regular array structure
                    categoryData.forEach(skill => {
                        if (isSkillMastered(currentLevel, category, skill)) {
                            mastered.push(skill);
                        } else {
                            needsWork.push(skill);
                        }
                    });
                }
            });
            
            const totalSkills = mastered.length + needsWork.length;
            const percent = totalSkills > 0 ? Math.round((mastered.length / totalSkills) * 100) : 0;
            
            // Get latest note
            let latestNote = '';
            if (student.sessions && student.sessions.length > 0) {
                const levelSessions = student.sessions
                    .filter(s => s.level === currentLevel && s.notes)
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                if (levelSessions.length > 0) {
                    latestNote = levelSessions[0].notes;
                }
            }
            
            // Create new window with 4x6 report
            const reportWindow = window.open('', '_blank', 'width=600,height=900');
            
            reportWindow.document.write(`
<!DOCTYPE html>
<html>
<head>
    <title>Progress Report - ${student.name}</title>
    <style>
        @page {
            size: 4in 6in;
            margin: 0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            width: 4in;
            height: 6in;
            padding: 0.3in;
            background: white;
            position: relative;
        }
        
        .report-card {
            border: 3px solid #1a73e8;
            border-radius: 8px;
            padding: 16px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            text-align: center;
            border-bottom: 2px solid #1a73e8;
            padding-bottom: 10px;
            margin-bottom: 12px;
        }
        
        .title {
            font-size: 18px;
            font-weight: bold;
            color: #1a73e8;
            margin-bottom: 4px;
        }
        
        .student-name {
            font-size: 16px;
            font-weight: bold;
            color: #202124;
            margin-bottom: 2px;
        }
        
        .level-info {
            font-size: 11px;
            color: #5f6368;
        }
        
        .stats-box {
            background: #e8f0fe;
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .stats-row {
            display: flex;
            justify-content: space-around;
            margin-bottom: 4px;
        }
        
        .stat {
            font-size: 11px;
            color: #5f6368;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #1a73e8;
            display: block;
        }
        
        .section {
            margin-bottom: 10px;
            flex: 1;
        }
        
        .section-title {
            font-size: 12px;
            font-weight: bold;
            color: #202124;
            margin-bottom: 6px;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .mastered-title {
            background: #e8f5e9;
            color: #137333;
        }
        
        .needs-work-title {
            background: #fef7e0;
            color: #b06000;
        }
        
        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            font-size: 10px;
            max-height: 80px;
            overflow: hidden;
        }
        
        .skill {
            background: #f8f9fa;
            padding: 3px 8px;
            border-radius: 10px;
            border: 1px solid #dadce0;
            white-space: nowrap;
        }
        
        .skill.mastered {
            background: #e8f5e9;
            border-color: #34a853;
            color: #137333;
        }
        
        .skill.needs {
            background: #fef7e0;
            border-color: #f9ab00;
            color: #b06000;
        }
        
        .notes {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #dadce0;
            font-size: 10px;
            color: #202124;
            margin-top: 8px;
            overflow: hidden;
            max-height: 60px;
        }
        
        .footer {
            text-align: center;
            font-size: 9px;
            color: #5f6368;
            margin-top: auto;
            padding-top: 8px;
            border-top: 1px solid #e8eaed;
        }
        
        .print-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px 20px;
            background: #1a73e8;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .print-btn:hover {
            background: #1557b0;
        }
        
        @media print {
            .print-btn {
                display: none;
            }
            
            body {
                width: 4in;
                height: 6in;
            }
        }
        
        @media screen {
            body {
                margin: 20px auto;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }
        }
    </style>
</head>
<body>
    <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print Card</button>
    
    <div class="report-card">
        <div class="header">
            <div class="title">üìö PROGRESS REPORT CARD</div>
            <div class="student-name">${student.name}</div>
            <div class="level-info">${currentLevel} ‚Ä¢ ${new Date().toLocaleDateString()}</div>
        </div>
        
        <div class="stats-box">
            <div class="stats-row">
                <div class="stat">
                    <span class="stat-value">${mastered.length}</span>
                    Mastered
                </div>
                <div class="stat">
                    <span class="stat-value">${needsWork.length}</span>
                    To Practice
                </div>
                <div class="stat">
                    <span class="stat-value">${percent}%</span>
                    Complete
                </div>
            </div>
        </div>
        
        ${mastered.length > 0 ? `
        <div class="section">
            <div class="section-title mastered-title">‚úÖ Skills Mastered (Great Job!)</div>
            <div class="skills-list">
                ${mastered.slice(0, 20).map(s => `<span class="skill mastered">${s}</span>`).join('')}
                ${mastered.length > 20 ? `<span class="skill mastered">+${mastered.length - 20} more</span>` : ''}
            </div>
        </div>
        ` : ''}
        
        ${needsWork.length > 0 ? `
        <div class="section">
            <div class="section-title needs-work-title">üìù Practice This Week</div>
            <div class="skills-list">
                ${needsWork.slice(0, 20).map(s => `<span class="skill needs">${s}</span>`).join('')}
                ${needsWork.length > 20 ? `<span class="skill needs">+${needsWork.length - 20} more</span>` : ''}
            </div>
        </div>
        ` : ''}
        
        ${latestNote ? `
        <div class="notes">
            <strong>Teacher's Note:</strong> ${latestNote}
        </div>
        ` : ''}
        
        <div class="footer">
            Keep practicing! üåü Every skill mastered is a step forward!
        </div>
    </div>
</body>
</html>
            `);
            
            reportWindow.document.close();
        }
        
        // Initialize
        loadData();
        renderStudentGrid();
    </script>
</body>
</html>